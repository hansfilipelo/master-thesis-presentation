%% beamerthemeLiU.sty
%% Copyright 2015 Clas Veibäck
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% This work has the LPPL maintenance status `maintained'.
% 
% The Current Maintainer of this work is Clas Veibäck.
%
% This work consists of the files beamer*themeLiU.sty
%
%% THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
%% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
%% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
%% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
%% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
%% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
%% SOFTWARE.

\mode<presentation>

%%
%% Packages
%%
\usepackage{etex}
\usepackage{multicol}

%%
%%	Read Options
%%
\DeclareOptionBeamer{titlecolor}{\PassOptionsToPackage{titlecolor=#1}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{outlinecolor}{\PassOptionsToPackage{outlinecolor=#1}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{endcolor}{\PassOptionsToPackage{endcolor=#1}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{blockcolor}{\PassOptionsToPackage{blockcolor=#1}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{complementary}{\PassOptionsToPackage{complementary=#1}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{highcontrast}{\PassOptionsToPackage{highcontrast}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{superhighcontrast}{\PassOptionsToPackage{superhighcontrast}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{dark}{\PassOptionsToPackage{dark}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{handout}{\PassOptionsToPackage{handout}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{homepage}{\PassOptionsToPackage{homepage}{beamercolorthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{shadow}{\PassOptionsToPackage{shadow}{beamerinnerthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{rounded}{\PassOptionsToPackage{rounded}{beamerinnerthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{font}{\PassOptionsToPackage{font=#1}{beamerfontthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{navigation}{\PassOptionsToPackage{navigation}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{noheader}{\PassOptionsToPackage{noheader}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{minimalheader}{\PassOptionsToPackage{minimalheader}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{noheadertitle}{\PassOptionsToPackage{noheadertitle}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{noheaderauthor}{\PassOptionsToPackage{noheaderauthor}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{noheaderdate}{\PassOptionsToPackage{noheaderdate}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{noheadernumber}{\PassOptionsToPackage{noheadernumber}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{nofooter}{\PassOptionsToPackage{nofooter}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{totalframes}{\PassOptionsToPackage{totalframes}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{tightpage}{\PassOptionsToPackage{tightpage}{beamerouterthemeLiU}}
\ProcessOptionsBeamer
\DeclareOptionBeamer{footerimage}{\PassOptionsToPackage{footerimage}{beamerouterthemeLiU}\PassOptionsToPackage{footerimage}{beamercolorthemeLiU}}
\ProcessOptionsBeamer

\newif\ifLiU@titlepageimage\LiU@titlepageimagefalse%% Option to add image to title page
\DeclareOptionBeamer{titlepageimage}{\LiU@titlepageimagetrue\PassOptionsToPackage{titlepageimage}{beamercolorthemeLiU}}
\ProcessOptionsBeamer

\newif\ifLiU@endpage\LiU@endpagetrue%% Option for removing end page.
\DeclareOptionBeamer{noendpage}{\LiU@endpagefalse}
\ProcessOptionsBeamer

\newif\ifLiU@outline\LiU@outlinetrue%% Option for removing outline.
\DeclareOptionBeamer{nooutline}{\LiU@outlinefalse}
\ProcessOptionsBeamer

\def\LiU@outlinecolumns{1}%% Option for number of outline columns
\DeclareOptionBeamer{outlinecolumns}{\def\LiU@outlinecolumns{#1}}    
\ProcessOptionsBeamer

\newif\ifLiU@institute\LiU@institutefalse%% Option for showing institute on title page.
\DeclareOptionBeamer{showinstitute}{\LiU@institutetrue}
\ProcessOptionsBeamer

%%
%% Set themes
%%
\useinnertheme{LiU}
\useoutertheme{LiU}
\usecolortheme{LiU}
\usefonttheme{LiU}

%%
%% LIU FRAME
%%
\newdimen\LiU@titlemargin
\LiU@titlemargin = 25mm

\newdimen\LiU@logobottom
\LiU@logobottom = 4mm

\newdimen\LiU@titlewidth
\LiU@titlewidth = \paperwidth
\advance \LiU@titlewidth by-2\LiU@titlemargin

\newdimen\LiU@logomargin
\LiU@logomargin = \LiU@titlemargin
\advance \LiU@logomargin by-0.5\LiU@logo@large@width%% According to specification

\newcommand<>{\LiUframe}[2][blue]{%
	\begingroup%
		\setbeamertemplate{navigation symbols}{}%
		\setbeamercolor{background canvas}{parent=#1}%
		\setbeamertemplate{footline}[LiUframe][#1]%
		\setbeamertemplate{headline}[LiUframe]%
		\setbeamertemplate{frametitle}[LiUframe][#1]%
		\usebeamercolor[fg]{#1}%
		%
		\begin{frame}#3%
			\begin{center}%
				\begin{minipage}[c][0.6\paperheight][c]{1.01\LiUframewidth}%
					#2%
				\end{minipage}
			\end{center}%
		\end{frame}%
	\endgroup%
}

% \newcommand<>{\LiUframe}[2][blue]{%
	% \begingroup%
		% \setbeamertemplate{navigation symbols}{}%
		% \begin{frame}#3[plain]%
			% \begin{beamercolorbox}[wd=\paperwidth,ht=\paperheight,left]{#1}%
				% \begin{center}%
					% \begin{minipage}[c][0.6\paperheight][c]{1\LiUframewidth}%
						% #2%
					% \end{minipage}
				% \end{center}%
				% \hskip\LiUframelogomargin%
				% \vskip0mm%
				% \begin{minipage}{\paperwidth}%
					% \hskip\LiUframelogomargin \insertLargeLogo{#1}  \hfill \ifLiU@titlepageimage  \insertLargeImage{#1} \hspace{\LiUframelogomargin} \fi%
				% \end{minipage}%
				% \vskip\LiUframelogobottom%
			% \end{beamercolorbox}%
		% \end{frame}%
	% \endgroup%
% }

%
% TITLE PAGE
%
\def\maketitle{%
	\ifbeamer@inframe%
		\PackageWarning{LiU}{%
			\begin{verbatim}%
				\maketitle must be called outside frame.
			\end{verbatim}%
		}%
	\else%
		\LiUframe[titlepage]{%
			\titlepage%
		}%
	\fi%
}%

\newdimen\LiU@titlepage@position
\LiU@titlepage@position = 10mm

\newdimen\LiU@titlepage@titlesparation
\LiU@titlepage@titlesparation = 3mm

\newdimen\LiU@titlepage@instituteseparation
\LiU@titlepage@instituteseparation = 3mm

\newdimen\LiU@titlepage@institutebottom
\LiU@titlepage@institutebottom = -10mm

\defbeamertemplate*{title page}{LiU}[1][]{%	
	%%
	%% Title page is page 0 
	\setcounter{framenumber}{0}%
	%%
	%% Insert title
	\raggedright\usebeamerfont{title}\inserttitle\par%
	%%
	%% Insert subtitle if needed
	\ifx\insertsubtitle\@empty\else%
		{\usebeamerfont{subtitle}\insertsubtitle\par}%
	\fi%
	%%
	%% Insert author
	\vskip\LiU@titlepage@titlesparation%
	\raggedright\usebeamerfont{author in title}\insertauthor%
	%%
	%% Insert institute if needed
	\ifx\insertinstitute\@empty\else%
		\ifLiU@institute%
			\vskip\LiU@titlepage@instituteseparation
				\raggedright\usebeamerfont{institute in title}\insertinstitute%
			\vspace{\LiU@titlepage@institutebottom}%
		\fi%
	\fi%
	\vspace{\LiU@titlepage@position}%
}

%
% END PAGE
%
\def\makeend{%
	\ifbeamer@inframe%
		\PackageWarning{LiU}{%
			\begin{verbatim}%
				\makeend must be called outside frame.
			\end{verbatim}%
		}%
	\else%
		\LiUframe[endpage]{%
			\endpage%
		}%
	\fi%
}

\newdimen\LiU@endpage@textposition
\LiU@endpage@textposition = 0mm

\newdimen\LiU@endpage@separation
\LiU@endpage@separation= 2mm

\defbeamertemplate*{end page}{LiU}[1][]{%
	\begin{center}%
		\ifx\LiU@finaltext\LiU@empty%
			\usebeamerfont{endauthor}\insertauthor\par%
		\else%
			\usebeamerfont{endtext}\LiU@finaltext\par%
		\fi%
		\vspace{\LiU@endpage@separation}
		\usebeamerfont{endlink}\href{www.liu.se}{www.liu.se}%
	\end{center}%
	\vspace{\LiU@endpage@textposition}%
}

\def\endpage{\usebeamertemplate*{end page}}

\ifLiU@endpage
  \AtEndDocument{\makeend}
\fi

%
% OUTLINE PAGE
%

\newcommand{\makeoutline}[1][]{%
	\begingroup%
		\setbeamertemplate{outline page}[LiU][#1]%
		\ifbeamer@inframe%
			\outlinepage%
		\else%
			\LiUframe[outlinepage]{%
				\outlinepage%
			}
		\fi%
	\endgroup%
}

\newdimen\LiU@outlineposition
\LiU@outlineposition = -4mm

\defbeamertemplate*{outline page}{LiU}[1][]{%
	\hspace{\LiU@outlineposition}
	\begin{minipage}[c]{1.0\LiUframewidth}%
		\if\LiU@outlinecolumns1%
			\tableofcontents[#1]%
		\else%
			\begin{multicols}{\LiU@outlinecolumns}%
				\tableofcontents[#1]%
			\end{multicols}%
		\fi%
	\end{minipage}%
}

\def\outlinepage{\usebeamertemplate*{outline page}}

\ifLiU@outline
	\AtBeginSection[]{\makeoutline[currentsection]}
\fi

%%
%% Macro Export
%%
\def\LiUframewidth{\LiU@titlewidth}
\def\LiUframemargin{\LiU@titlemargin}
\def\LiUframelogomargin{\LiU@logomargin}
\def\LiUframelogobottom{\LiU@logobottom}
\newcommand{\finaltext}[1]{\gdef\LiU@finaltext{#1}}

\mode<all>
